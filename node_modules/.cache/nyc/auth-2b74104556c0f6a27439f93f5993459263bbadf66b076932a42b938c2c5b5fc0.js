function cov_n3rxzid55(){var path="C:\\Users\\Ronald\\Desktop\\UNSW\\Y2T1\\SENG2021\\Anemone\\src\\main\\server\\auth.js";var hash="9ec65880e7b766c82f7d92b86a45ec94424913a5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Ronald\\Desktop\\UNSW\\Y2T1\\SENG2021\\Anemone\\src\\main\\server\\auth.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:35}},"1":{start:{line:3,column:19},end:{line:3,column:38}},"2":{start:{line:7,column:22},end:{line:7,column:32}},"3":{start:{line:9,column:23},end:{line:9,column:45}},"4":{start:{line:11,column:24},end:{line:11,column:66}},"5":{start:{line:12,column:20},end:{line:12,column:49}},"6":{start:{line:14,column:21},end:{line:14,column:35}},"7":{start:{line:16,column:4},end:{line:20,column:6}},"8":{start:{line:22,column:4},end:{line:22,column:27}},"9":{start:{line:24,column:4},end:{line:24,column:19}},"10":{start:{line:29,column:21},end:{line:29,column:35}},"11":{start:{line:30,column:18},end:{line:30,column:67}},"12":{start:{line:30,column:41},end:{line:30,column:66}},"13":{start:{line:33,column:4},end:{line:37,column:5}},"14":{start:{line:34,column:8},end:{line:36,column:10}},"15":{start:{line:40,column:4},end:{line:44,column:5}},"16":{start:{line:41,column:8},end:{line:43,column:9}},"17":{start:{line:46,column:4},end:{line:49,column:5}},"18":{start:{line:52,column:0},end:{line:52,column:49}}},fnMap:{"0":{name:"generateToken",decl:{start:{line:6,column:9},end:{line:6,column:22}},loc:{start:{line:6,column:33},end:{line:25,column:1}},line:6},"1":{name:"tokenIsValid",decl:{start:{line:28,column:9},end:{line:28,column:21}},loc:{start:{line:28,column:31},end:{line:50,column:1}},line:28},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:32},end:{line:30,column:33}},loc:{start:{line:30,column:41},end:{line:30,column:66}},line:30}},branchMap:{"0":{loc:{start:{line:33,column:4},end:{line:37,column:5}},type:"if",locations:[{start:{line:33,column:4},end:{line:37,column:5}},{start:{line:33,column:4},end:{line:37,column:5}}],line:33},"1":{loc:{start:{line:40,column:4},end:{line:44,column:5}},type:"if",locations:[{start:{line:40,column:4},end:{line:44,column:5}},{start:{line:40,column:4},end:{line:44,column:5}}],line:40}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9ec65880e7b766c82f7d92b86a45ec94424913a5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_n3rxzid55=function(){return actualCoverage;};}return actualCoverage;}cov_n3rxzid55();const other=(cov_n3rxzid55().s[0]++,require("./other.js"));const ONE_DAY_MS=(cov_n3rxzid55().s[1]++,24*60*60*1000);// Generate a unique token wtih expiration time and adds it to the valid tokens list
function generateToken(username){cov_n3rxzid55().f[0]++;const timestamp=(cov_n3rxzid55().s[2]++,Date.now());// Expiration time of 1 day from now
const expiration=(cov_n3rxzid55().s[3]++,timestamp+ONE_DAY_MS);// Generates a base-36 string and then extracts 16 digits
const tokenString=(cov_n3rxzid55().s[4]++,Math.random().toString(36).substring(2,17));const tokenId=(cov_n3rxzid55().s[5]++,`${timestamp}_${tokenString}`);const jsonData=(cov_n3rxzid55().s[6]++,getTokenData());cov_n3rxzid55().s[7]++;jsonData.push({tokenId:tokenId,username:username,expiration:expiration});cov_n3rxzid55().s[8]++;setTokenData(jsonData);cov_n3rxzid55().s[9]++;return tokenId;}// Authenticates that a token is valid, returns a boolean value + corresponding user
function tokenIsValid(tokenId){cov_n3rxzid55().f[1]++;const jsonData=(cov_n3rxzid55().s[10]++,getTokenData());const token=(cov_n3rxzid55().s[11]++,jsonData.find(token=>{cov_n3rxzid55().f[2]++;cov_n3rxzid55().s[12]++;return token.tokenId===tokenId;}));// Could not find token
cov_n3rxzid55().s[13]++;if(token===undefined){cov_n3rxzid55().b[0][0]++;cov_n3rxzid55().s[14]++;return{valid:false};}else{cov_n3rxzid55().b[0][1]++;}// Token has expired
cov_n3rxzid55().s[15]++;if(token.expiration<Date.now()){cov_n3rxzid55().b[1][0]++;cov_n3rxzid55().s[16]++;return{valid:false};}else{cov_n3rxzid55().b[1][1]++;}cov_n3rxzid55().s[17]++;return{valid:true,username:token.userename};}cov_n3rxzid55().s[18]++;module.exports={generateToken,tokenIsValid};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfbjNyeHppZDU1IiwiYWN0dWFsQ292ZXJhZ2UiLCJvdGhlciIsInMiLCJyZXF1aXJlIiwiT05FX0RBWV9NUyIsImdlbmVyYXRlVG9rZW4iLCJ1c2VybmFtZSIsImYiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiZXhwaXJhdGlvbiIsInRva2VuU3RyaW5nIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwidG9rZW5JZCIsImpzb25EYXRhIiwiZ2V0VG9rZW5EYXRhIiwicHVzaCIsInNldFRva2VuRGF0YSIsInRva2VuSXNWYWxpZCIsInRva2VuIiwiZmluZCIsInVuZGVmaW5lZCIsImIiLCJ2YWxpZCIsInVzZXJlbmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJhdXRoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG90aGVyID0gcmVxdWlyZShcIi4vb3RoZXIuanNcIik7XHJcblxyXG5jb25zdCBPTkVfREFZX01TID0gMjQgKiA2MCAqIDYwICogMTAwMDtcclxuXHJcbi8vIEdlbmVyYXRlIGEgdW5pcXVlIHRva2VuIHd0aWggZXhwaXJhdGlvbiB0aW1lIGFuZCBhZGRzIGl0IHRvIHRoZSB2YWxpZCB0b2tlbnMgbGlzdFxyXG5mdW5jdGlvbiBnZW5lcmF0ZVRva2VuKHVzZXJuYW1lKSB7XHJcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgLy8gRXhwaXJhdGlvbiB0aW1lIG9mIDEgZGF5IGZyb20gbm93XHJcbiAgICBjb25zdCBleHBpcmF0aW9uID0gdGltZXN0YW1wICsgT05FX0RBWV9NUztcclxuICAgIC8vIEdlbmVyYXRlcyBhIGJhc2UtMzYgc3RyaW5nIGFuZCB0aGVuIGV4dHJhY3RzIDE2IGRpZ2l0c1xyXG4gICAgY29uc3QgdG9rZW5TdHJpbmcgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwxNyk7XHJcbiAgICBjb25zdCB0b2tlbklkID0gYCR7dGltZXN0YW1wfV8ke3Rva2VuU3RyaW5nfWA7XHJcbiAgICBcclxuICAgIGNvbnN0IGpzb25EYXRhID0gZ2V0VG9rZW5EYXRhKCk7XHJcblxyXG4gICAganNvbkRhdGEucHVzaCh7XHJcbiAgICAgICAgdG9rZW5JZDogdG9rZW5JZCxcclxuICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgZXhwaXJhdGlvbjogZXhwaXJhdGlvblxyXG4gICAgfSlcclxuXHJcbiAgICBzZXRUb2tlbkRhdGEoanNvbkRhdGEpO1xyXG5cclxuICAgIHJldHVybiB0b2tlbklkO1xyXG59XHJcblxyXG4vLyBBdXRoZW50aWNhdGVzIHRoYXQgYSB0b2tlbiBpcyB2YWxpZCwgcmV0dXJucyBhIGJvb2xlYW4gdmFsdWUgKyBjb3JyZXNwb25kaW5nIHVzZXJcclxuZnVuY3Rpb24gdG9rZW5Jc1ZhbGlkKHRva2VuSWQpIHtcclxuICAgIGNvbnN0IGpzb25EYXRhID0gZ2V0VG9rZW5EYXRhKCk7XHJcbiAgICBjb25zdCB0b2tlbiA9IGpzb25EYXRhLmZpbmQodG9rZW4gPT4gdG9rZW4udG9rZW5JZCA9PT0gdG9rZW5JZCk7XHJcblxyXG4gICAgLy8gQ291bGQgbm90IGZpbmQgdG9rZW5cclxuICAgIGlmICh0b2tlbiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsaWQ6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUb2tlbiBoYXMgZXhwaXJlZFxyXG4gICAgaWYgKHRva2VuLmV4cGlyYXRpb24gPCBEYXRlLm5vdygpKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsaWQ6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdmFsaWQ6IHRydWUsXHJcbiAgICAgICAgdXNlcm5hbWU6IHRva2VuLnVzZXJlbmFtZVxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgZ2VuZXJhdGVUb2tlbiwgdG9rZW5Jc1ZhbGlkIH07Il0sIm1hcHBpbmdzIjoiOG5GQWVZO0FBQUFBLGFBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsYUFBQSxHQWZaLEtBQU0sQ0FBQUUsS0FBSyxFQUFBRixhQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUVuQyxLQUFNLENBQUFDLFVBQVUsRUFBQUwsYUFBQSxHQUFBRyxDQUFBLE1BQUcsRUFBRSxDQUFHLEVBQUUsQ0FBRyxFQUFFLENBQUcsSUFBSSxFQUV0QztBQUNBLFFBQVMsQ0FBQUcsYUFBYUEsQ0FBQ0MsUUFBUSxDQUFFLENBQUFQLGFBQUEsR0FBQVEsQ0FBQSxNQUM3QixLQUFNLENBQUFDLFNBQVMsRUFBQVQsYUFBQSxHQUFBRyxDQUFBLE1BQUdPLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFDNUI7QUFDQSxLQUFNLENBQUFDLFVBQVUsRUFBQVosYUFBQSxHQUFBRyxDQUFBLE1BQUdNLFNBQVMsQ0FBR0osVUFBVSxFQUN6QztBQUNBLEtBQU0sQ0FBQVEsV0FBVyxFQUFBYixhQUFBLEdBQUFHLENBQUEsTUFBR1csSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUNDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQzlELEtBQU0sQ0FBQUMsT0FBTyxFQUFBbEIsYUFBQSxHQUFBRyxDQUFBLE1BQUksR0FBRU0sU0FBVSxJQUFHSSxXQUFZLEVBQUMsRUFFN0MsS0FBTSxDQUFBTSxRQUFRLEVBQUFuQixhQUFBLEdBQUFHLENBQUEsTUFBR2lCLFlBQVksQ0FBQyxDQUFDLEVBQUNwQixhQUFBLEdBQUFHLENBQUEsTUFFaENnQixRQUFRLENBQUNFLElBQUksQ0FBQyxDQUNWSCxPQUFPLENBQUVBLE9BQU8sQ0FDaEJYLFFBQVEsQ0FBRUEsUUFBUSxDQUNsQkssVUFBVSxDQUFFQSxVQUNoQixDQUFDLENBQUMsQ0FBQVosYUFBQSxHQUFBRyxDQUFBLE1BRUZtQixZQUFZLENBQUNILFFBQVEsQ0FBQyxDQUFDbkIsYUFBQSxHQUFBRyxDQUFBLE1BRXZCLE1BQU8sQ0FBQWUsT0FBTyxDQUNsQixDQUVBO0FBQ0EsUUFBUyxDQUFBSyxZQUFZQSxDQUFDTCxPQUFPLENBQUUsQ0FBQWxCLGFBQUEsR0FBQVEsQ0FBQSxNQUMzQixLQUFNLENBQUFXLFFBQVEsRUFBQW5CLGFBQUEsR0FBQUcsQ0FBQSxPQUFHaUIsWUFBWSxDQUFDLENBQUMsRUFDL0IsS0FBTSxDQUFBSSxLQUFLLEVBQUF4QixhQUFBLEdBQUFHLENBQUEsT0FBR2dCLFFBQVEsQ0FBQ00sSUFBSSxDQUFDRCxLQUFLLEVBQUksQ0FBQXhCLGFBQUEsR0FBQVEsQ0FBQSxNQUFBUixhQUFBLEdBQUFHLENBQUEsY0FBQXFCLEtBQUssQ0FBQ04sT0FBTyxHQUFLQSxPQUFPLENBQUQsQ0FBQyxDQUFDLEVBRS9EO0FBQUFsQixhQUFBLEdBQUFHLENBQUEsT0FDQSxHQUFJcUIsS0FBSyxHQUFLRSxTQUFTLENBQUUsQ0FBQTFCLGFBQUEsR0FBQTJCLENBQUEsU0FBQTNCLGFBQUEsR0FBQUcsQ0FBQSxPQUNyQixNQUFPLENBQ0h5QixLQUFLLENBQUUsS0FDWCxDQUFDLENBQ0wsQ0FBQyxLQUFBNUIsYUFBQSxHQUFBMkIsQ0FBQSxVQUVEO0FBQUEzQixhQUFBLEdBQUFHLENBQUEsT0FDQSxHQUFJcUIsS0FBSyxDQUFDWixVQUFVLENBQUdGLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFBWCxhQUFBLEdBQUEyQixDQUFBLFNBQUEzQixhQUFBLEdBQUFHLENBQUEsT0FDL0IsTUFBTyxDQUNIeUIsS0FBSyxDQUFFLEtBQ1gsQ0FBQyxDQUNMLENBQUMsS0FBQTVCLGFBQUEsR0FBQTJCLENBQUEsVUFBQTNCLGFBQUEsR0FBQUcsQ0FBQSxPQUVELE1BQU8sQ0FDSHlCLEtBQUssQ0FBRSxJQUFJLENBQ1hyQixRQUFRLENBQUVpQixLQUFLLENBQUNLLFNBQ3BCLENBQUMsQ0FDTCxDQUFDN0IsYUFBQSxHQUFBRyxDQUFBLE9BRUQyQixNQUFNLENBQUNDLE9BQU8sQ0FBRyxDQUFFekIsYUFBYSxDQUFFaUIsWUFBYSxDQUFDIiwiaWdub3JlTGlzdCI6W119